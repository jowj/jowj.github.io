<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>Project notes: getting playable audio files out of a .gba rom | josiah&#39;s blog</title>
<link rel="stylesheet" href="/css/my-dark.css">


<link rel="icon" type="image/svg+xml" href="/favicon.svg">

</head>
<body>
  <header>
    
<div class="site-header">
    
    <a href="http://localhost:1313//" class="logo-link">
        <svg class="site-logo" width="150" height="75" viewBox="0 0 200 100">
            
            <path
                d="M20 50 C40 20, 80 30, 100 50 C120 70, 160 80, 180 50"
                stroke="white"
                stroke-width="4"
                fill="none"
            />

            
            <path d="M100 30 L115 50 L100 70 L85 50 Z" fill="#cc99ff" />

            
            <circle cx="20" cy="50" r="3" fill="black" />
            <circle cx="60" cy="35" r="3" fill="black" />
            <circle cx="140" cy="65" r="3" fill="black" />
            <circle cx="180" cy="50" r="3" fill="black" />

            
            <line
                x1="60"
                y1="35"
                x2="85"
                y2="50"
                stroke="white"
                stroke-width="2"
            />
            <line
                x1="115"
                y1="50"
                x2="140"
                y2="65"
                stroke="white"
                stroke-width="2"
            />
        </svg>
    </a>
    <nav>
    <a href="/">/home</a>
    <a href="/posts/">/posts</a>
    <a href="/personal/">/diary</a>
    <a href="/projects/">/projects</a>
    <a href="/resume.pdf">/resume</a>
    <a href="/lore/">/lore</a>
</nav>

</div>

  </header>
  <main>
    
<h1>Project notes: getting playable audio files out of a .gba rom</h1>

  <p>I want to have, say, a ring tone from megaman battle network 3 blue, somehow. I don’t know what i want exactly, but something from that game. I own the game 8 times over, surely there&rsquo;s a way to do this.</p>
<h2 id="outline">Outline</h2>
<ol>
<li>How do I get the files from the .gba file itself?
<ol>
<li>This is apparently annoying and lossy, but <code>vgmtrans</code> ~works.</li>
<li>I was suggested several other options but they require manually editing makefiles and compiling c++, gross, lets skip those.</li>
</ol>
</li>
<li><code>VGMtrans</code> is pretty self explantory, poke around the UI to find the files you want. You’ll have to play every sound collection in there to know what they are though.</li>
<li>Export all your files in various formats to your file system, again, just in the UI.</li>
<li>Next, a digression into how the resultant audio files work:
<ol>
<li><code>.MID</code> files are midi files, which contain music <em>sequences</em> but no <em>sound</em>.</li>
<li><code>DLS</code> is a “downloadable sounds” file, which contains sound samples that can be used by MIDI</li>
<li><code>SF2</code> is a soundfount file, basically an alternative to DLS.</li>
<li>Probably you only need either DLS or SF2 at a single time, just depends on what’s supported by the DAW you’ll be working with in next step</li>
</ol>
</li>
<li>Now you have all the bare files exported, but you need to recombine them into a file that your phone can understand.
<ol>
<li><code>LMMS</code> is free / open source. There’s better options, but not without a price tag.</li>
<li><code>LMMS</code> works, I did an original POC with it, but its not easily automatable. But! There is something that IS automatiable on the commandline called  <code>fluidsynth</code>  that gets us alllllmost all the way there - it can give us <code>.wav</code> files.</li>
<li>Once you have a <code>.wav</code> its easy to use ffmpeg to get <code>.mp3</code></li>
</ol>
</li>
</ol>
<h2 id="conversion-script">Conversion script</h2>
<p>I llm’d a script to do this for me en masse:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> subprocess
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pdb
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Directory where your files are located</span>
</span></span><span style="display:flex;"><span>root <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/Users/josiah/mmbn3/&#34;</span>
</span></span><span style="display:flex;"><span>export_dir <span style="color:#f92672">=</span> root <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;exports&#34;</span>
</span></span><span style="display:flex;"><span>directory <span style="color:#f92672">=</span> root <span style="color:#f92672">+</span> <span style="color:#e6db74">&#34;raws&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Go through each MIDI file and find its matching SF2 file</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> file <span style="color:#f92672">in</span> os<span style="color:#f92672">.</span>listdir(directory):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> file<span style="color:#f92672">.</span>endswith(<span style="color:#e6db74">&#34;.mid&#34;</span>):
</span></span><span style="display:flex;"><span>        midi_file <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(directory, file)
</span></span><span style="display:flex;"><span>        sf2_file <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(directory, file<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;.mid&#34;</span>, <span style="color:#e6db74">&#34;.sf2&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(sf2_file):
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Output WAV file name</span>
</span></span><span style="display:flex;"><span>            output_wav <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(export_dir, file<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;.mid&#34;</span>, <span style="color:#e6db74">&#34;.wav&#34;</span>))
</span></span><span style="display:flex;"><span>            output_mp3 <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(export_dir, file<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;.mid&#34;</span>, <span style="color:#e6db74">&#34;.mp3&#34;</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Run Fluidsynth to combine the files and export to WAV</span>
</span></span><span style="display:flex;"><span>            subprocess<span style="color:#f92672">.</span>run([
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;fluidsynth&#34;</span>, <span style="color:#e6db74">&#34;-ni&#34;</span>, sf2_file, midi_file, <span style="color:#e6db74">&#34;-F&#34;</span>, output_wav
</span></span><span style="display:flex;"><span>            ])
</span></span><span style="display:flex;"><span>            subprocess<span style="color:#f92672">.</span>run([
</span></span><span style="display:flex;"><span>                <span style="color:#e6db74">&#34;ffmpeg&#34;</span>, <span style="color:#e6db74">&#34;-i&#34;</span>, output_wav, output_mp3
</span></span><span style="display:flex;"><span>            ])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Delete the WAV file after MP3 is successfully created</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(output_mp3):
</span></span><span style="display:flex;"><span>                os<span style="color:#f92672">.</span>remove(output_wav)
</span></span><span style="display:flex;"><span>                print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Deleted intermediate file: </span><span style="color:#e6db74">{</span>output_wav<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;Processed </span><span style="color:#e6db74">{</span>file<span style="color:#e6db74">}</span><span style="color:#e6db74"> -&gt; </span><span style="color:#e6db74">{</span>output_mp3<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><h2 id="iphone-idiocy">iphone idiocy</h2>
<p>You’d think you’d be done, simply import them to your phone and bam you got ring tones!</p>
<p>Wrong.</p>
<p>On iPhone, for historic “we sell ringtones” reasons, its still very annoying to get a sound file to be recognized by the system as appropriate for ring tone useage.</p>
<ol>
<li>Put your files on icloud drive somewhere</li>
<li>Open garageband on your phone</li>
<li>Create a new project with the <code>audio recorder</code> option</li>
<li>Import your audio file
<ol>
<li>Tap the <code>loop</code> icon in the top right</li>
<li>Go to the weird loop thing on the top right</li>
<li><code>browse items from the files app</code></li>
</ol>
</li>
<li>Trim audio as needed</li>
<li>Tap the <code>down arrow</code> in the top left, select “my songs” and then select from storage, import the specific file.
<ol>
<li>Tap on the song song you’ve just created</li>
<li>The select share</li>
<li>Choose ringtone.</li>
</ol>
</li>
<li>Now assign as default ringtone in settings, or per contact</li>
</ol>
<h2 id="problems-with-this-approach">Problems with this approach</h2>
<p>This has worked mostly well! But there&rsquo;s a few things that are sub-optimal that i haven&rsquo;t figured out:</p>
<ol>
<li>There&rsquo;s definitely some sound effects I can&rsquo;t find. Probably that&rsquo;s weirdness in the import process to vgmtrans, but no idea what i can do about it</li>
<li>Despite exporting the sf2 files, the sounds are just a bit off when it comes to the soundtrack - the midi file / sequence definitely works, but the instruments must be subtly different.
<ol>
<li>I&rsquo;m tempted to try remixing all the files with DLS instead of sf2 and see if it changes the output, but i&rsquo;m out of time today :|</li>
</ol>
</li>
<li>I haven&rsquo;t figured out a bulletproof way to have notifications on iPhone setup the way i want
<ol>
<li>Apple watches mess with your notification scheme, both individually per app and globally with the <code>silent</code> option.</li>
</ol>
</li>
</ol>
 
  </main>
  <footer>
    <copyright>
    <p>MOVE THE WORLD BENEATH YOUR WHEELS.</p>
</copyright>

  </footer>
</body>
</html>
