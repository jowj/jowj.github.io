<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>using org caldav with fastmail | josiah&#39;s blog</title>
<link rel="stylesheet" href="/css/my-dark.css">


<link rel="icon" type="image/svg+xml" href="/favicon.svg">

</head>
<body>
  <header>
    
<div class="site-header">
    
    <a href="http://localhost:1313//" class="logo-link">
        <svg class="site-logo" width="150" height="75" viewBox="0 0 200 100">
            
            <path
                d="M20 50 C40 20, 80 30, 100 50 C120 70, 160 80, 180 50"
                stroke="white"
                stroke-width="4"
                fill="none"
            />

            
            <path d="M100 30 L115 50 L100 70 L85 50 Z" fill="#cc99ff" />

            
            <circle cx="20" cy="50" r="3" fill="black" />
            <circle cx="60" cy="35" r="3" fill="black" />
            <circle cx="140" cy="65" r="3" fill="black" />
            <circle cx="180" cy="50" r="3" fill="black" />

            
            <line
                x1="60"
                y1="35"
                x2="85"
                y2="50"
                stroke="white"
                stroke-width="2"
            />
            <line
                x1="115"
                y1="50"
                x2="140"
                y2="65"
                stroke="white"
                stroke-width="2"
            />
        </svg>
    </a>
    <nav>
    <a href="/">/home</a>
    <a href="/posts/">/posts</a>
    <a href="/personal/">/diary</a>
    <a href="/projects/">/projects</a>
    <a href="/resume.pdf">/resume</a>
    <a href="/lore/">/lore</a>
</nav>

</div>

  </header>
  <main>
    
<h1>using org caldav with fastmail</h1>

  <h2 id="how-to-sync-calendar-events-from-fastmail-to-your-org-agenda">how to sync calendar events from fastmail to your org agenda</h2>
<p>i&rsquo;ve recently started a new job. i take a lot of notes, and I find it useful to take notes for each meeting along with some metadata about each meeting. the notes i obviously take as the meeting goes on, but the metadata is already in the meeting invite. rather than entering all of it manually for each meeting, I&rsquo;ve had org-mode pull the meeting info for me.</p>
<h3 id="doing-this">doing this</h3>
<ol>
<li>download <a href="https://github.com/dengste/org-caldav">org-caldav</a></li>
<li>configure it</li>
<li>run <code>org-caldav-sync</code></li>
<li>cool you&rsquo;re done</li>
</ol>
<h4 id="really-though">really though,</h4>
<p>ok its only slightly more complicated than that. for fastmail, you can&rsquo;t follow the instructions as given exactly. Here&rsquo;s the broad way to configure it (i&rsquo;ll use <code>use-package</code> because so does everyone):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(use-package org-caldav
</span></span><span style="display:flex;"><span>  :ensure <span style="color:#66d9ef">t</span>
</span></span><span style="display:flex;"><span>  :config
</span></span><span style="display:flex;"><span>  (setq org-caldav-url <span style="color:#e6db74">&#34;https://caldav.fastmail.com/dav/calendars/user/your@domain.tld/&#34;</span>)
</span></span><span style="display:flex;"><span>  (setq org-caldav-calendars
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">&#39;</span>((:calendar-id <span style="color:#e6db74">&#34;00000000-0000-0000-0000-000000000000&#34;</span>
</span></span><span style="display:flex;"><span>                        :inbox <span style="color:#e6db74">&#34;~/org/calendar-events.org&#34;</span>)))
</span></span><span style="display:flex;"><span>  (setq org-icalendar-timezone <span style="color:#e6db74">&#34;America/Chicago&#34;</span>))
</span></span></code></pre></div><p>that&rsquo;s basically it. here&rsquo;s one of two original examples given in repo for reference:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(setq org-caldav-calendars
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#39;</span>((:calendar-id <span style="color:#e6db74">&#34;work@whatever&#34;</span> :files (<span style="color:#e6db74">&#34;~/org/work.org&#34;</span>)
</span></span><span style="display:flex;"><span>     :inbox <span style="color:#e6db74">&#34;~/org/fromwork.org&#34;</span>)
</span></span></code></pre></div><p>the way my method differs from the original instructions is the <code>org-caldav-url</code> and <code>calendar-id</code> vars. the string to use for the <code>url</code> is pulled from the fastmail documentation <a href="https://www.fastmail.help/hc/en-us/articles/1500000278342#calendar">here</a>. the <code>calendar-id</code> is behind your authwall; login -&gt; settings -&gt; calendars -&gt; locate your calendar -&gt; click the export button for that item. Here you should see a full URL in a text box that looks like this:</p>
<p><code>https://caldav.fastmail.com/dav/calendars/user/your@user.tld/00000000-0000-0000-0000-00000000000000000</code></p>
<p>copy everything after your <code>user@domain.tld</code>; that goes in your <code>calendar-id</code> field.</p>
<h3 id="org-gcal-as-an-alternative-to-org-caldav">org-gcal as an alternative to org-caldav</h3>
<p>there are a few different ways to sync calendars into org-mode. <a href="https://github.com/emacsmirror/org-gcal">org-gcal</a> is for folks running gcal for events. however, be warned that you must have a certain level of permission within your Google Org for that account to be useful; you need enough permission to create an API key within the org. for someone&rsquo;s personal accounts that probably works. if you&rsquo;re trying to integrate with a work account, where permissions should be more locked down, you will need to do something else.</p>
<p>google <em>really</em> would prefer that you don&rsquo;t use caldav to talk to their calendars. org-cal is based on google&rsquo;s own API, and doesn&rsquo;t adhere to normal email standards.  this is shitty, but frankly caldav is a fucking mess, so you can&rsquo;t really blame them.</p>
<h3 id="access-gcal-calendars-with-org-caldav">access gcal calendars with org-caldav</h3>
<p>so, what&rsquo;s a person to do if they don&rsquo;t have the ability to use google&rsquo;s api to pull down calendars, but they still need to sync gcal stuff to orgmode? well, you can do something kind of dumb, but easy. gcal publishes your calendar to an unauthed but secret URL by default. you can subscribe to that URL from within fastmail, and then sync that calendar down to org mode through fastmail!</p>
<h4 id="doing-this">doing this</h4>
<ol>
<li>copy the url from the google calender</li>
<li>subscribe to the url in fastmail (and i assume any provider that uses caldav)</li>
<li>sync that calendar down to org mode via org-caldav!</li>
</ol>
<h4 id="details">details</h4>
<p>access the URL that google publishes to by logging into gcal -&gt; settings -&gt; click on the calendar you want to access on the left hand side of the screen -&gt; scroll down until you see &ldquo;secret address in iCal format&rdquo;. copy that URL.</p>
<p>subscribe to the calendar in fastmail by logging into fastmail -&gt; settings -&gt; click on calendars on the left hand side -&gt; find the box labeled &ldquo;Subscriptions&rdquo; and paste in the URL there. hit subscribe. done!</p>
<h4 id="other-options">other options</h4>
<p>fastmail <em>also</em> allows you to log into a few providers specifically. I suspect this is done by simply mimicking a client, so fastmail speaks the gcal API and you can have access to everything that way. I haven&rsquo;t tried this, though I may get curious eventually. If you try it <a href="mailto:me@jowj.net">i&rsquo;d love to know!</a></p>
<h3 id="credential-storage">credential storage</h3>
<p>syncing events to org mode manually seems fine to me; i&rsquo;ll typically do it once, maybe twice a day. typing in credentials each time you want to sync sucks though. this type of problem is commonly solved 1 of two ways, in emacs:</p>
<ol>
<li>authinfo</li>
<li>authinfo, but encrypted with gpg</li>
</ol>
<p>you should encrypt the file with gpg. this is not too difficult!</p>
<h4 id="doing-this">doing this</h4>
<ol>
<li>create a gpg key and trust it</li>
<li>create a file that you will encrypt, adding the login details to the file</li>
<li>configure emacs to look at this file for <code>auth-sources</code></li>
<li>test to make sure your changes work</li>
</ol>
<h4 id="details">details</h4>
<p>you should create a gpg key and trust it. there are other guides for how to do that. here are a few:</p>
<ul>
<li><a href="https://blog.eleven-labs.com/en/openpgp-almost-perfect-key-pair-part-1/">https://blog.eleven-labs.com/en/openpgp-almost-perfect-key-pair-part-1/</a></li>
<li><a href="https://alexcabal.com/creating-the-perfect-gpg-keypair">https://alexcabal.com/creating-the-perfect-gpg-keypair</a></li>
<li>god gpg sucks</li>
</ul>
<p>then, within emacs, open a file that you will encrypt. make sure it ends in <code>.gpg</code>. when you do that, emacs will prompt you for how you want to encrypt the file. you will see your newly added gpg key and id listed as an option. use that.</p>
<p>next, fill the file with your login creds in a vaguely frustrating format. here&rsquo;s how its supposed to look:
<code>machine www.google.com:443 port https login your.username password your.secret</code></p>
<p>specification of port:443 and https is <em>required</em> because <code>authsource</code> is weird.</p>
<p>now you need a minor bit of customization to make this work. the below snippet works just fine on my linux and mac machines. there are some added bits that are set if you&rsquo;re on a mac (<code>epa-pinentry-mode</code> to avoid errors. the rest of pretty self explantory.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-elisp" data-lang="elisp"><span style="display:flex;"><span>(require <span style="color:#e6db74">&#39;epa</span>)
</span></span><span style="display:flex;"><span>(when (<span style="color:#a6e22e">eq</span> system-type <span style="color:#e6db74">&#39;darwin</span>)
</span></span><span style="display:flex;"><span>  (setf epa-pinentry-mode <span style="color:#e6db74">&#39;loopback</span>))
</span></span><span style="display:flex;"><span>(setq auth-sources <span style="color:#f92672">&#39;</span>(<span style="color:#e6db74">&#34;~/.emacs.d/yoursecrets.gpg&#34;</span>))
</span></span><span style="display:flex;"><span>(setq auth-source-debug <span style="color:#66d9ef">t</span>)
</span></span></code></pre></div><p>finally, test and make sure your calendar event sync works without prompting you for a password by evaluating that lisp and then running <code>org-caldav-sync</code> again. if you&rsquo;ve set everything up correctly it will auto sync and you won&rsquo;t have had to type anything extra!</p>
<p>nice!</p>
 
  </main>
  <footer>
    <copyright>
    <p>MOVE THE WORLD BENEATH YOUR WHEELS.</p>
</copyright>

  </footer>
</body>
</html>
